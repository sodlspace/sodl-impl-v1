---
interface Props {
  title?: string;
}

const { title = 'example.sodl' } = Astro.props;
---

<div class="overflow-hidden rounded-xl border border-neutral-700 bg-neutral-900 shadow-2xl shadow-black/50">
  <!-- Title bar -->
  <div class="flex items-center justify-between border-b border-neutral-700 bg-neutral-800 px-4 py-3">
    <div class="flex items-center gap-3">
      <!-- Traffic lights -->
      <div class="flex items-center gap-1.5" aria-hidden="true">
        <div class="h-3 w-3 rounded-full bg-red-500/70"></div>
        <div class="h-3 w-3 rounded-full bg-yellow-500/70"></div>
        <div class="h-3 w-3 rounded-full bg-green-500/70"></div>
      </div>
      <!-- File name -->
      <span class="text-xs font-medium text-neutral-400">{title}</span>
    </div>

    <!-- Copy button -->
    <button
      class="code-copy-btn flex items-center gap-1.5 rounded-md px-2.5 py-1 text-xs font-medium text-neutral-400 hover:bg-neutral-700 hover:text-white transition-all focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500"
      aria-label="Copy code to clipboard"
      type="button"
    >
      <svg class="copy-icon h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
        <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
      </svg>
      <svg class="check-icon h-3.5 w-3.5 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <polyline points="20 6 9 17 4 12"/>
      </svg>
      <span class="copy-label">Copy</span>
    </button>
  </div>

  <!-- Code content via slot -->
  <div class="code-preview-content overflow-x-auto p-4 text-sm leading-relaxed font-mono text-neutral-300">
    <slot />
  </div>
</div>

<script>
  document.querySelectorAll('.code-copy-btn').forEach((btn) => {
    btn.addEventListener('click', async () => {
      const container = btn.closest('.overflow-hidden');
      const content = container?.querySelector('.code-preview-content');
      const text = content?.textContent ?? '';

      try {
        await navigator.clipboard.writeText(text.trim());
        const copyIcon = btn.querySelector('.copy-icon') as HTMLElement | null;
        const checkIcon = btn.querySelector('.check-icon') as HTMLElement | null;
        const label = btn.querySelector('.copy-label') as HTMLElement | null;
        if (copyIcon) copyIcon.classList.add('hidden');
        if (checkIcon) checkIcon.classList.remove('hidden');
        if (label) label.textContent = 'Copied!';
        setTimeout(() => {
          if (copyIcon) copyIcon.classList.remove('hidden');
          if (checkIcon) checkIcon.classList.add('hidden');
          if (label) label.textContent = 'Copy';
        }, 2000);
      } catch {
        // clipboard not available
      }
    });
  });
</script>
